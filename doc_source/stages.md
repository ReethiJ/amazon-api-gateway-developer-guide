# Set up a Stage Using the API Gateway Console<a name="stages"></a>

**Topics**
+ [Create a New Stage](#how-to-create-stage-console)
+ [Update Stage Settings](#how-to-stage-settings)
+ [Delete a Stage for an API](#how-to-delete-stage)

## Create a New Stage<a name="how-to-create-stage-console"></a>

 After the initial deployment, you can add more stages and associate them with existing deployments\. You can use the API Gateway console to create and use a new stage or choose an existing stage while deploying an API\. In general, you can add a new stage to an API deployment before redeploying the API\. To do so using the API Gateway console, follow the instructions below\. 

1. Sign in to the API Gateway console at [https://console\.aws\.amazon\.com/apigateway](https://console.aws.amazon.com/apigateway)\.

1. From the **APIs** navigation pane, choose **Stages** under an API\.

1. From the **Stages** navigation pane, choose **Create**\.

1.  Under **Create Stage**, type a stage name, for example, **prod**, for **Stage name**\. 

1.  Optionally, type a stage description for **Stage description** 

1. From the **Deployment** drop\-down list, choose the date and time of the existing API deployment you want to associate with this stage\.

1. Choose **Create**\.

## Update Stage Settings<a name="how-to-stage-settings"></a>

After a successful deployment of an API, the stage is populated with default settings\. You can use the console or API Gateway REST API to change the stage settings, including API caching and logging\. In the following, we show how to do so using the **Stage Editor** of the API Gateway console\.

### Update Stage Settings Using the API Gateway Console<a name="how-to-stage-settings-console"></a>

These steps assume that you have already deployed the API to a stage\. 

1. Sign in to the API Gateway console at [https://console\.aws\.amazon\.com/apigateway](https://console.aws.amazon.com/apigateway)\.

1. In the **APIs** pane, choose the API, and then choose **Stages**\.

1. In the **Stages** pane, choose the name of the stage\.

1. In the **Stage Editor** pane, choose the **Settings** tab\.

1. To enable API caching for the stage, select the **Enable API cache** option under the **Cache Settings** section\. Then choose desired options and associated values for **Cache capacity**, **Encrypt cache data**, **Cache time\-to\-live \(TTL\)**, as well as any requirements for per\-key cache invalidation\.

   For more information about stage\-level cache settings, see [Enable API Caching](api-gateway-caching.md)\.
**Important**  
If you enable API caching for an API stage, your AWS account may be charged for API caching\. Cachine is not eligible for the AWS free tier\.
**Tip**  
You can also override enabled stage\-level cache settings for individual methods\. To do so, expand the stage under the **Stages** secondary navigation pane and choose a method\. Then, in the stage editor, choose the **Override for this method** option for **Settings**\. In the **Cache Settings** area, you can set or clear **Enable Method Cache** or customize any other desired options\. For more information about the method\-level cache settings, see [Enable API Caching](api-gateway-caching.md)\.

1. To enable Amazon CloudWatch Logs for all of the methods associated with this stage of this API Gateway API, do the following:

   1.  Under the **CloudWatch Settings** section, select the **Enable CloudWatch Logs** option\. 
**Tip**  
 To enable method\-level CloudWatch settings, expand the stage under the **Stages** secondary navigation pane, choose each method of interest, and, back in the stage editor, choose **Override for this method** for **Settings**\. In the **CloudWatch Settings** area, make sure to select **Log to CloudWatch Logs** and any other desired options, before choosing **Save Changes**\. 
**Important**  
Your account will be charged for accessing method\-level CloudWatch metrics, but not the API\- or stage\- level metrics\.

   1. For **Log level**, choose **ERROR** to write only error\-level entries to CloudWatch Logs, or choose **INFO** to include all **ERROR** events as well as extra informational events\. 

   1. To log full API call request and response information, select **Log full requests/responses data**\. No sensitive data will be logged unless the **Log full requests/responses data** option is selected\.

   1. To have API Gateway report to CloudWatch the API metrics of `API calls`, `Latency`, `Integration latency`, `400 errors` and `500 errors`, choose **Enable Detailed CloudWatch Metrics** option\. For more information about CloudWatch, see the [Amazon CloudWatch User Guide](https://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/)\.

   1. Choose **Save Changes**\. The new settings will take effect after a new deployment\.
**Important**  
To enable CloudWatch Logs for all or only some of the methods, you must also specify the ARN of an IAM role that enables API Gateway to write information to CloudWatch Logs on behalf of your IAM user\. To do so, choose **Settings** from the **APIs** main navigation pane\. Then type the ARN of an IAM role in the **CloudWatch log role ARN** text field\. For common application scenarios, the IAM role could attach the managed policy of `AmazonAPIGatewayPushToCloudWatchLogs`, which contains the following access policy statement:  

      ```
      {
          "Version": "2012-10-17",
          "Statement": [
              {
                  "Effect": "Allow",
                  "Action": [
                      "logs:CreateLogGroup",
                      "logs:CreateLogStream",
                      "logs:DescribeLogGroups",
                      "logs:DescribeLogStreams",
                      "logs:PutLogEvents",
                      "logs:GetLogEvents",
                      "logs:FilterLogEvents"
                  ],
                  "Resource": "*"
              }
          ]
      }
      ```
The IAM role must also contain the following trust relationship statement:  

      ```
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Sid": "",
            "Effect": "Allow",
            "Principal": {
              "Service": "apigateway.amazonaws.com"
            },
            "Action": "sts:AssumeRole"
          }
        ]
      }
      ```
For more information about CloudWatch, see the [Amazon CloudWatch User Guide](https://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/)\.

1.  To set the stage\-level throttle limit for all of the methods associated with this API, do the following in the **Default Method Throttling** section: 

   1.  For **Rate**, type the maximum number of stage\-level steady\-state requests per second that API Gateway can serve without returning a `429 Too Many Requests` response\. This stage\-level rate limit must not be more than the [account\-level](api-gateway-request-throttling.md#apig-request-throttling-account-level-limits) rate limit as specified in [API Gateway Limits for Configuring and Running an API](limits.md#api-gateway-execution-service-limits-table)\. 

   1.  For **Burst**, type the maximum number of stage\-level concurrent requests that API Gateway can serve without returning a `429 Too Many Requests` response\. This stage\-level burst must not be more than the [account\-level](api-gateway-request-throttling.md#apig-request-throttling-account-level-limits) burst limit as specified in [API Gateway Limits for Configuring and Running an API](limits.md#api-gateway-execution-service-limits-table)\. 

1.  To override the stage\-level throttling for an individual method, expand the stage in the **Stages** secondary navigation pane, choose a method, and choose **Override for this method** for **Settings**\. In the **Method Throttling** section, select appropriate options\. 

1. To enable [AWS X\-Ray](https://docs.aws.amazon.com/xray/latest/devguide/xray-services-apigateway.html) tracing for the API stage:

   1. In the **Stage Editor** pane, choose the **Logs/Tracing** tab\.

   1. To enable X\-Ray tracing, choose **Enable X\-Ray Tracing** under **X\-Ray Tracing**\.

   1. To set sampling rules in the X\-Ray console, choose **Set X\-Ray Sampling Rules**\.

   1. If desired, choose **Set X\-Ray Sampling Rules** and go to the X\-Ray console to [configure sampling rules](https://docs.aws.amazon.com/xray/latest/devguide/xray-console-sampling.html)\.

   For more information, see [Trace API Gateway API Execution with AWS X\-Ray](apigateway-xray.md)\.

1. Choose **Save Changes**\. The new settings will take effect after you redeploy the API to the stage\.

## Delete a Stage for an API<a name="how-to-delete-stage"></a>

When you no longer need a stage, you can delete it to avoid paying for unused resources\. In the following, we explain how to use the API Gateway console to delete a stage \.

**Warning**  
 Deleting a stage may cause part or all of the corresponding API to be unusable by API callers\. Deleting a stage cannot be undone, but you can recreate the stage and associate it with the same deployment\. 

### Delete a Stage with the API Gateway Console<a name="how-to-delete-stage-console"></a>

1. Sign in to the API Gateway console at [https://console\.aws\.amazon\.com/apigateway](https://console.aws.amazon.com/apigateway)\.

1. In the box that contains the name of the API for the stage, choose **Stages**\.

1. In the **Stages** pane, choose the stage you want to delete, and then choose **Delete Stage**\.

1. When prompted, choose **Delete**\.